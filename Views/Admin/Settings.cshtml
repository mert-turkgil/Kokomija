@model Kokomija.Models.ViewModels.Admin.SiteSettingsViewModel
@{
    ViewData["Title"] = "Site Settings";
}

<div class="admin-dashboard">
    <div class="container-fluid py-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="welcome-card">
                    <h1>
                        <i class="bi bi-gear"></i>
                        Site Settings
                    </h1>
                    <p class="mb-0">Manage your website configuration, carousel, categories, and translations</p>
                </div>
            </div>
        </div>

        <!-- Settings Tabs -->
        <div class="row">
            <div class="col-12">
                <div class="settings-tabs-container">
                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs settings-nav-tabs" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a href="@Url.Action("Index", "Admin")" class="nav-link">
                                <i class="bi bi-speedometer2"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="carousel-tab" data-bs-toggle="tab" 
                                    data-bs-target="#carousel" type="button" role="tab">
                                <i class="bi bi-images"></i>
                                <span>Carousel</span>
                                <span class="badge bg-primary ms-2">@Model.ActiveCarouselSlides/@Model.TotalCarouselSlides</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="categories-tab" data-bs-toggle="tab" 
                                    data-bs-target="#categories" type="button" role="tab">
                                <i class="bi bi-folder"></i>
                                <span>Categories</span>
                                <span class="badge bg-success ms-2">@Model.TotalCategories</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="translations-tab" data-bs-toggle="tab" 
                                    data-bs-target="#translations" type="button" role="tab">
                                <i class="bi bi-translate"></i>
                                <span>Translations</span>
                                <span class="badge bg-info ms-2">@Model.TotalTranslationKeys</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="general-tab" data-bs-toggle="tab" 
                                    data-bs-target="#general" type="button" role="tab">
                                <i class="bi bi-sliders"></i>
                                <span>General</span>
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content settings-tab-content" id="settingsTabContent">
                        <!-- Carousel Tab -->
                        <div class="tab-pane fade show active" id="carousel" role="tabpanel">
                            <div class="settings-section">
                                <div class="section-header">
                                    <h4>
                                        <i class="bi bi-images"></i>
                                        Carousel Management
                                    </h4>
                                    <a asp-action="CarouselCreate" class="btn btn-primary">
                                        <i class="bi bi-plus-lg"></i>
                                        Add New Slide
                                    </a>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-primary">
                                                <i class="bi bi-images"></i>
                                            </div>
                                            <div>
                                                <h6>@Model.TotalCarouselSlides</h6>
                                                <small>Total Slides</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-success">
                                                <i class="bi bi-check-circle"></i>
                                            </div>
                                            <div>
                                                <h6>@Model.ActiveCarouselSlides</h6>
                                                <small>Active</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                @if (Model.CarouselSlides.Any())
                                {
                                    <div class="table-responsive">
                                        <table class="table settings-table" id="carouselSlidesTable">
                                            <thead>
                                                <tr>
                                                    <th width="60">Order</th>
                                                    <th>Preview</th>
                                                    <th>Title</th>
                                                    <th>Location</th>
                                                    <th>Status</th>
                                                    <th>Schedule</th>
                                                    <th width="150">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="carousel-sortable">
                                                @foreach (var slide in Model.CarouselSlides)
                                                {
                                                    <tr data-id="@slide.Id"
                                                        data-title="@slide.Title"
                                                        data-subtitle="@slide.Subtitle"
                                                        data-button-text="@slide.ButtonText"
                                                        data-link-url="@slide.LinkUrl"
                                                        data-location="@slide.Location"
                                                        data-display-order="@slide.DisplayOrder"
                                                        data-is-active="@slide.IsActive"
                                                        data-image-path="@slide.ImagePath"
                                                        data-start-date="@(slide.StartDate?.ToString("yyyy-MM-ddTHH:mm"))"
                                                        data-end-date="@(slide.EndDate?.ToString("yyyy-MM-ddTHH:mm"))">
                                                        <td>
                                                            <div class="drag-handle">
                                                                <i class="bi bi-grip-vertical"></i>
                                                                <span class="badge bg-secondary">@slide.DisplayOrder</span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="carousel-preview">
                                                                <img src="@slide.ImagePath" alt="@slide.Title" class="carousel-thumb">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <strong>@slide.Title</strong>
                                                            @if (!string.IsNullOrEmpty(slide.Subtitle))
                                                            {
                                                                <br><small class="text-muted">@slide.Subtitle</small>
                                                            }
                                                        </td>
                                                        <td>
                                                            <span class="badge bg-info">@slide.Location</span>
                                                        </td>
                                                        <td>
                                                            @if (slide.IsActive)
                                                            {
                                                                <span class="badge bg-success">
                                                                    <i class="bi bi-check-circle"></i> Active
                                                                </span>
                                                            }
                                                            else
                                                            {
                                                                <span class="badge bg-secondary">
                                                                    <i class="bi bi-x-circle"></i> Inactive
                                                                </span>
                                                            }
                                                        </td>
                                                        <td>
                                                            @if (slide.StartDate.HasValue || slide.EndDate.HasValue)
                                                            {
                                                                <small>
                                                                    @if (slide.StartDate.HasValue)
                                                                    {
                                                                        <div>From: @slide.StartDate.Value.ToString("MMM dd, yyyy")</div>
                                                                    }
                                                                    @if (slide.EndDate.HasValue)
                                                                    {
                                                                        <div>To: @slide.EndDate.Value.ToString("MMM dd, yyyy")</div>
                                                                    }
                                                                </small>
                                                            }
                                                            else
                                                            {
                                                                <small class="text-muted">Always</small>
                                                            }
                                                        </td>
                                                        <td>
                                                            <div class="btn-group" role="group">
                                                                <a asp-action="CarouselEdit" asp-route-id="@slide.Id" 
                                                                   class="btn btn-sm btn-outline-primary" 
                                                                   title="Edit">
                                                                    <i class="bi bi-pencil"></i>
                                                                </a>
                                                                <button class="btn btn-sm btn-outline-warning" 
                                                                        onclick="toggleSlideStatus(@slide.Id)" 
                                                                        title="Toggle Status">
                                                                    <i class="bi bi-toggle-on"></i>
                                                                </button>
                                                                <button type="button" 
                                                                        class="btn btn-sm btn-outline-danger" 
                                                                        onclick="deleteCarouselSlide(event, @slide.Id, '@(slide.Title.Replace("'", "\\'" ).Replace("\"", "&quot;"))')"
                                                                        title="Delete">
                                                                    <i class="bi bi-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                }
                                else
                                {
                                    <div class="empty-state">
                                        <i class="bi bi-images"></i>
                                        <p>No carousel slides found</p>
                                        <a asp-action="CarouselCreate" class="btn btn-primary mt-3">
                                            <i class="bi bi-plus-lg"></i>
                                            Create First Slide
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>

                        <!-- Categories Tab -->
                        <div class="tab-pane fade" id="categories" role="tabpanel">
                            <div class="settings-section">
                                <div class="section-header">
                                    <h4>
                                        <i class="bi bi-folder"></i>
                                        Category Management
                                    </h4>
                                    <a href="@Url.Action("CategoryCreate", "Admin")" class="btn btn-primary">
                                        <i class="bi bi-plus-lg"></i>
                                        Add New Category
                                    </a>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-primary">
                                                <i class="bi bi-folder"></i>
                                            </div>
                                            <div>
                                                <h6>@Model.TotalCategories</h6>
                                                <small>Main Categories</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-success">
                                                <i class="bi bi-folder-symlink"></i>
                                            </div>
                                            <div>
                                                <h6>@Model.TotalSubcategories</h6>
                                                <small>Subcategories</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-info">
                                                <i class="bi bi-check-circle"></i>
                                            </div>
                                            <div>
                                                <h6>@Model.ActiveCategories</h6>
                                                <small>Active</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                @if (Model.Categories.Any())
                                {
                                    <div class="categories-tree">
                                        @foreach (var category in Model.Categories)
                                        {
                                            <div class="category-item" data-id="@category.Id">
                                                <div class="category-header">
                                                    <div class="category-info">
                                                        <div class="drag-handle">
                                                            <i class="bi bi-grip-vertical"></i>
                                                        </div>
                                                        @if (!string.IsNullOrEmpty(category.ImageUrl))
                                                        {
                                                            <img src="@category.ImageUrl" alt="@category.Name" class="category-icon-img">
                                                        }
                                                        else if (!string.IsNullOrEmpty(category.IconCssClass))
                                                        {
                                                            <div class="category-icon">
                                                                <i class="@category.IconCssClass"></i>
                                                            </div>
                                                        }
                                                        <div class="category-details">
                                                            <strong>@category.Name</strong>
                                                        <div class="category-meta">
                                                            <span class="badge bg-secondary bg-opacity-10 text-body">@category.Slug</span>
                                                            @if (!string.IsNullOrEmpty(category.NameKey))
                                                            {
                                                                <span class="badge bg-info bg-opacity-10 text-info">@category.NameKey</span>
                                                            }
                                                            <span class="text-muted small"><i class="bi bi-box me-1"></i>@category.ProductCount products</span>
                                                        </div>
                                                        </div>
                                                    </div>
                                                    <div class="category-actions">
                                                        @if (category.IsActive)
                                                        {
                                                            <span class="badge bg-success bg-opacity-10 text-success me-2"><i class="bi bi-check-circle me-1"></i>Active</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="badge bg-secondary bg-opacity-10 text-secondary me-2"><i class="bi bi-x-circle me-1"></i>Inactive</span>
                                                        }
                                                        @if (category.ShowInNavbar)
                                                        {
                                                            <span class="badge bg-primary bg-opacity-10 text-primary me-2"><i class="bi bi-menu-button-wide me-1"></i>Navbar</span>
                                                        }
                                                        <div class="btn-group btn-group-sm" role="group">
                                                            <a href="@Url.Action("CategoryEdit", "Admin", new { id = category.Id })" class="btn btn-outline-primary" title="Edit Category">
                                                                <i class="bi bi-pencil-square"></i>
                                                            </a>
                                                            <button class="btn @(category.IsActive ? "btn-outline-warning" : "btn-outline-success")" onclick="toggleCategoryStatus(@category.Id)" title="@(category.IsActive ? "Deactivate" : "Activate")">
                                                                <i class="bi bi-@(category.IsActive ? "pause" : "play")-circle"></i>
                                                            </button>
                                                            <form asp-action="CategoryDelete" asp-controller="Admin" method="post" class="d-inline" onsubmit="return confirm('âš ï¸ Delete category: @category.Name?\n\nThis will also delete all subcategories and cannot be undone.');">
                                                                <input type="hidden" name="id" value="@category.Id" />
                                                                <button type="submit" class="btn btn-outline-danger" title="Delete Category">
                                                                    <i class="bi bi-trash3"></i>
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>

                                                @if (category.Subcategories.Any())
                                                {
                                                    <div class="subcategories">
                                                        @foreach (var sub in category.Subcategories)
                                                        {
                                                            <div class="subcategory-item" data-id="@sub.Id">
                                                                <div class="subcategory-content">
                                                                    <div class="drag-handle">
                                                                        <i class="bi bi-grip-vertical"></i>
                                                                    </div>
                                                                    <i class="bi bi-arrow-return-right text-muted me-2"></i>
                                                                    @if (!string.IsNullOrEmpty(sub.IconCssClass))
                                                                    {
                                                                        <i class="@sub.IconCssClass me-2"></i>
                                                                    }
                                                                    <div class="subcategory-details">
                                                                        <strong>@sub.Name</strong>
                                                                        <div class="category-meta">
                                                                            <span class="badge bg-secondary bg-opacity-10 text-body">@sub.Slug</span>
                                                                            @if (!string.IsNullOrEmpty(sub.NameKey))
                                                                            {
                                                                                <span class="badge bg-info bg-opacity-10 text-info">@sub.NameKey</span>
                                                                            }
                                                                            <span class="text-muted small"><i class="bi bi-box me-1"></i>@sub.ProductCount products</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="subcategory-actions">
                                                                        @if (sub.IsActive)
                                                                        {
                                                                            <span class="badge bg-success bg-opacity-10 text-success me-2"><i class="bi bi-check-circle me-1"></i>Active</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span class="badge bg-secondary bg-opacity-10 text-secondary me-2"><i class="bi bi-x-circle me-1"></i>Inactive</span>
                                                                        }
                                                                        <div class="btn-group btn-group-sm" role="group">
                                                                            <a href="@Url.Action("CategoryEdit", "Admin", new { id = sub.Id })" class="btn btn-outline-primary" title="Edit Subcategory">
                                                                                <i class="bi bi-pencil-square"></i>
                                                                            </a>
                                                                            <button class="btn @(sub.IsActive ? "btn-outline-warning" : "btn-outline-success")" onclick="toggleCategoryStatus(@sub.Id)" title="@(sub.IsActive ? "Deactivate" : "Activate")">
                                                                                <i class="bi bi-@(sub.IsActive ? "pause" : "play")-circle"></i>
                                                                            </button>
                                                                            <form asp-action="CategoryDelete" asp-controller="Admin" method="post" class="d-inline" onsubmit="return confirm('âš ï¸ Delete subcategory: @sub.Name?\n\nThis cannot be undone.');">
                                                                                <input type="hidden" name="id" value="@sub.Id" />
                                                                                <button type="submit" class="btn btn-outline-danger" title="Delete Subcategory">
                                                                                    <i class="bi bi-trash3"></i>
                                                                                </button>
                                                                            </form>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="empty-state">
                                        <i class="bi bi-folder"></i>
                                        <p>No categories found</p>
                                        <a href="@Url.Action("CategoryCreate", "Admin")" class="btn btn-primary mt-3">
                                            <i class="bi bi-plus-lg"></i>
                                            Create First Category
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>

                        <!-- Translations Tab -->
                        <div class="tab-pane fade" id="translations" role="tabpanel">
                            <div class="settings-section">
                                <div class="section-header">
                                    <h4>
                                        <i class="bi bi-translate"></i>
                                        Translation Management
                                    </h4>
                                    <button class="btn btn-primary" onclick="loadTranslationFiles()" title="Refresh translation files">
                                        <i class="bi bi-arrow-clockwise"></i>
                                        Refresh
                                    </button>
                                </div>

                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-primary">
                                                <i class="bi bi-key"></i>
                                            </div>
                                            <div>
                                                <h6>@Model.TotalTranslationKeys</h6>
                                                <small>Translation Keys</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-success">
                                                <i class="bi bi-file-earmark-text"></i>
                                            </div>
                                            <div>
                                                <h6 id="totalFilesCount">--</h6>
                                                <small>Resource Files</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card-small">
                                            <div class="stat-icon-small bg-info">
                                                <i class="bi bi-globe"></i>
                                            </div>
                                            <div>
                                                <h6>2</h6>
                                                <small>Languages</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Language Info -->
                                <div class="alert alert-info mb-4">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>Supported Languages:</strong> ðŸ‡ºðŸ‡¸ English (en-US) and ðŸ‡µðŸ‡± Polish (pl-PL) are currently enabled. 
                                    <br>
                                    <strong>âš¡ Live Reload:</strong> Changes are saved to .resx files and read directly from XML. 
                                    Simply refresh your browser (F5) to see changes immediately - no rebuild required!
                                </div> 
                                    <strong>Live Editing:</strong> Changes are saved instantly and will appear on page refresh.
                                </div>

                                <!-- File Filter & Search Bar -->
                                <div class="row mb-4">
                                    <div class="col-md-4">
                                        <label class="form-label">
                                            <i class="bi bi-folder"></i>
                                            Filter by Resource File
                                        </label>
                                        <select class="form-select" id="file-filter" onchange="handleFileFilterChange()">
                                            <option value="">All Files</option>
                                        </select>
                                    </div>
                                    <div class="col-md-8">
                                        <label class="form-label">
                                            <i class="bi bi-search"></i>
                                            Search Translations
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="bi bi-search"></i>
                                            </span>
                                            <input type="text" class="form-control" 
                                                   placeholder="Search by English text (e.g., 'Welcome', 'Account', 'Shopping Cart')..." 
                                                   id="translation-search-input">
                                            <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
                                                <i class="bi bi-x-lg"></i> Clear
                                            </button>
                                        </div>
                                        <small class="text-muted d-block mt-2">
                                            <i class="bi bi-lightbulb"></i> 
                                            Searches in keys, English values, Polish values, and comments
                                        </small>
                                    </div>
                                </div>

                                <!-- Loading State -->
                                <div id="translations-loading" class="text-center py-5" style="display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-3 text-muted">Loading translations...</p>
                                </div>

                                <!-- Results Count -->
                                <div id="translations-results-info" class="mb-3" style="display: none;">
                                    <span class="badge bg-info">
                                        <i class="bi bi-info-circle"></i>
                                        Showing <span id="resultsCount">0</span> translation(s)
                                    </span>
                                </div>

                                <!-- Translation Table -->
                                <div class="table-responsive">
                                    <table class="table settings-table translation-table table-sm">
                                        <thead>
                                            <tr>
                                                <th width="12%" class="d-none d-lg-table-cell">
                                                    <i class="bi bi-file-earmark-text"></i>
                                                    File
                                                </th>
                                                <th width="18%">
                                                    <i class="bi bi-key"></i>
                                                    Key
                                                </th>
                                                <th width="28%">
                                                    <span class="d-flex align-items-center gap-1">
                                                        ðŸ‡ºðŸ‡¸ English
                                                    </span>
                                                </th>
                                                <th width="28%">
                                                    <span class="d-flex align-items-center gap-1">
                                                        ðŸ‡µðŸ‡± Polish
                                                    </span>
                                                </th>
                                                <th width="14%" class="d-none d-md-table-cell">
                                                    <i class="bi bi-chat-left-text"></i>
                                                    Comment
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="translations-tbody">
                                            <tr>
                                                <td colspan="5" class="text-center text-muted py-4">
                                                    <i class="bi bi-info-circle fs-1 d-block mb-2"></i>
                                                    Select a file from the dropdown or use search to view translations
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Pagination -->
                                <div id="translations-pagination" class="mt-4" style="display: none;">
                                    <nav>
                                        <ul class="pagination justify-content-center" id="pagination-controls">
                                            <!-- Pagination buttons will be inserted here -->
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>

                        <!-- General Tab -->
                        <div class="tab-pane fade" id="general" role="tabpanel">
                            <div class="settings-section">
                                <div class="section-header">
                                    <h4>
                                        <i class="bi bi-sliders"></i>
                                        General Settings
                                    </h4>
                                    <button class="btn btn-primary">
                                        <i class="bi bi-save"></i>
                                        Save Changes
                                    </button>
                                </div>

                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i>
                                    General settings panel will be implemented in the next step.
                                </div>

                                <!-- Placeholder for general settings -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="settings-group">
                                            <h5>Site Information</h5>
                                            <div class="mb-3">
                                                <label class="form-label">Site Name</label>
                                                <input type="text" class="form-control" value="Kokomija" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Default Currency</label>
                                                <select class="form-select" disabled>
                                                    <option>PLN - Polish Zloty</option>
                                                    <option>EUR - Euro</option>
                                                    <option>USD - US Dollar</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="settings-group">
                                            <h5>Maintenance Mode</h5>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="maintenanceMode" disabled>
                                                <label class="form-check-label" for="maintenanceMode">
                                                    Enable Maintenance Mode
                                                </label>
                                            </div>
                                            <small class="text-muted">When enabled, only admins can access the site</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Slide Modal -->
<div class="modal fade" id="createSlideModal" tabindex="-1" aria-labelledby="createSlideModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createSlideModalLabel">
                    <i class="bi bi-plus-circle"></i>
                    Create New Carousel Slide
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createSlideForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="createSlideTitle" class="form-label">Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="createSlideTitle" name="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="createSlideSubtitle" class="form-label">Subtitle</label>
                            <input type="text" class="form-control" id="createSlideSubtitle" name="subtitle">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="createSlideButtonText" class="form-label">Button Text</label>
                            <input type="text" class="form-control" id="createSlideButtonText" name="buttonText">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="createSlideLinkUrl" class="form-label">Button Link URL</label>
                            <input type="url" class="form-control" id="createSlideLinkUrl" name="linkUrl" placeholder="https://...">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="createSlideLocation" class="form-label">Location <span class="text-danger">*</span></label>
                            <select class="form-select" id="createSlideLocation" name="location" required>
                                <option value="Home">Home Page</option>
                                <option value="Products">Products Page</option>
                                <option value="Category">Category Page</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="createSlideDisplayOrder" class="form-label">Display Order <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="createSlideDisplayOrder" name="displayOrder" min="0" value="0" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="createSlideIsActive" class="form-label">Status</label>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" id="createSlideIsActive" name="isActive" checked>
                                <label class="form-check-label" for="createSlideIsActive">Active</label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="createSlideStartDate" class="form-label">Start Date</label>
                            <input type="datetime-local" class="form-control" id="createSlideStartDate" name="startDate">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="createSlideEndDate" class="form-label">End Date</label>
                            <input type="datetime-local" class="form-control" id="createSlideEndDate" name="endDate">
                        </div>
                    </div>

                    <!-- Responsive Images Section -->
                    <div class="alert alert-info mb-3">
                        <i class="bi bi-info-circle"></i>
                        <strong>Responsive Images:</strong> Upload 3 images for optimal display across all devices.
                        Use naming convention: 1.jpg (Desktop), 2.jpg (Tablet), 3.jpg (Mobile)
                    </div>

                    <!-- Desktop Image (Required) -->
                    <div class="mb-3">
                        <label for="createSlideDesktopImage" class="form-label">
                            <i class="bi bi-display"></i> Desktop Image (1.jpg) <span class="text-danger">*</span>
                        </label>
                        <input type="file" class="form-control" id="createSlideDesktopImage" 
                               accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" required>
                        <small class="text-muted">Large screens (1920x800px recommended) â€¢ Max 5MB</small>
                        <div id="desktopImagePreview" class="mt-2" style="display: none;">
                            <img id="desktopImagePreviewImg" src="" alt="Desktop Preview" 
                                 style="max-width: 100%; max-height: 150px; object-fit: contain;" class="border rounded p-1">
                        </div>
                    </div>

                    <!-- Tablet Image (Optional) -->
                    <div class="mb-3">
                        <label for="createSlideTabletImage" class="form-label">
                            <i class="bi bi-tablet"></i> Tablet Image (2.jpg)
                        </label>
                        <input type="file" class="form-control" id="createSlideTabletImage" 
                               accept="image/jpeg,image/jpg,image/png,image/gif,image/webp">
                        <small class="text-muted">Medium screens (1024x600px recommended) â€¢ Max 5MB</small>
                        <div id="tabletImagePreview" class="mt-2" style="display: none;">
                            <img id="tabletImagePreviewImg" src="" alt="Tablet Preview" 
                                 style="max-width: 100%; max-height: 150px; object-fit: contain;" class="border rounded p-1">
                        </div>
                    </div>

                    <!-- Mobile Image (Optional) -->
                    <div class="mb-3">
                        <label for="createSlideMobileImage" class="form-label">
                            <i class="bi bi-phone"></i> Mobile Image (3.jpg)
                        </label>
                        <input type="file" class="form-control" id="createSlideMobileImage" 
                               accept="image/jpeg,image/jpg,image/png,image/gif,image/webp">
                        <small class="text-muted">Small screens (768x600px recommended) â€¢ Max 5MB</small>
                        <div id="mobileImagePreview" class="mt-2" style="display: none;">
                            <img id="mobileImagePreviewImg" src="" alt="Mobile Preview" 
                                 style="max-width: 100%; max-height: 150px; object-fit: contain;" class="border rounded p-1">
                        </div>
                    </div>

                    <input type="hidden" id="createSlideDesktopTempFileName" name="desktopTempFileName">
                    <input type="hidden" id="createSlideTabletTempFileName" name="tabletTempFileName">
                    <input type="hidden" id="createSlideMobileTempFileName" name="mobileTempFileName">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-lg"></i>
                        Create Slide
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Slide Modal -->
<div class="modal fade" id="editSlideModal" tabindex="-1" aria-labelledby="editSlideModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editSlideModalLabel">
                    <i class="bi bi-pencil"></i>
                    Edit Carousel Slide
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editSlideForm">
                <div class="modal-body">
                    <input type="hidden" id="slideId" name="slideId">
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="slideTitle" class="form-label">Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="slideTitle" name="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="slideSubtitle" class="form-label">Subtitle</label>
                            <input type="text" class="form-control" id="slideSubtitle" name="subtitle">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="slideButtonText" class="form-label">Button Text</label>
                            <input type="text" class="form-control" id="slideButtonText" name="buttonText">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="slideLinkUrl" class="form-label">Button Link URL</label>
                            <input type="url" class="form-control" id="slideLinkUrl" name="linkUrl" placeholder="https://...">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="slideLocation" class="form-label">Location <span class="text-danger">*</span></label>
                            <select class="form-select" id="slideLocation" name="location" required>
                                <option value="Home">Home Page</option>
                                <option value="Products">Products Page</option>
                                <option value="Category">Category Page</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="slideDisplayOrder" class="form-label">Display Order <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="slideDisplayOrder" name="displayOrder" min="0" value="0" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="slideIsActive" class="form-label">Status</label>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" id="slideIsActive" name="isActive">
                                <label class="form-check-label" for="slideIsActive">Active</label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="slideStartDate" class="form-label">Start Date (Optional)</label>
                            <input type="datetime-local" class="form-control" id="slideStartDate" name="startDate">
                            <small class="text-muted">Leave empty for immediate activation</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="slideEndDate" class="form-label">End Date (Optional)</label>
                            <input type="datetime-local" class="form-control" id="slideEndDate" name="endDate">
                            <small class="text-muted">Leave empty for no expiration</small>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="slideImagePath" class="form-label">Image Path <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="slideImagePath" name="imagePath" required>
                        <small class="text-muted">Path to image file (e.g., /img/carousel/slide1.jpg)</small>
                    </div>

                    <div class="mb-3" id="currentImagePreview">
                        <!-- Image preview will be shown here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css" />
    
    <style>
        .editable-cell {
            cursor: text;
            transition: all 0.2s ease;
        }
        
        .editable-cell:hover {
            border-color: #dee2e6 !important;
            background-color: rgba(var(--bs-primary-rgb), 0.05);
        }
        
        .editable-cell:focus {
            outline: none;
            border-color: var(--bs-primary) !important;
            background-color: #fff;
            box-shadow: 0 0 0 0.2rem rgba(var(--bs-primary-rgb), 0.15);
        }
        
        .editable-cell.save-success {
            border-color: var(--bs-success) !important;
            background-color: rgba(var(--bs-success-rgb), 0.1);
        }
        
        .translation-table {
            font-size: 0.9rem;
        }
        
        .translation-table code {
            background-color: rgba(var(--bs-secondary-rgb), 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }
        
        .comment-editable {
            font-style: italic;
            color: #6c757d;
        }
        
        .comment-editable:empty::before {
            content: 'Click to add comment...';
            color: #adb5bd;
        }
        
        @@media (max-width: 768px) {
            .translation-table {
                font-size: 0.85rem;
            }
            
            .editable-cell {
                min-height: 40px !important;
                font-size: 0.85rem;
            }
        }
    </style>
    
    <script>
        console.log('Site Settings page loaded');
        
        // Configure toastr
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "timeOut": "3000"
        };
        
        // Enable Bootstrap tabs
        const triggerTabList = document.querySelectorAll('#settingsTabs button');
        triggerTabList.forEach(triggerEl => {
            const tabTrigger = new bootstrap.Tab(triggerEl);
            triggerEl.addEventListener('click', event => {
                event.preventDefault();
                tabTrigger.show();
            });
        });

        // Toggle slide active status using AdminController AJAX action
        window.toggleSlideStatus = async function(slideId) {
            if (!confirm('Toggle this slide\'s active status?')) return;
            
            try {
                const response = await fetch(`@Url.Action("CarouselToggleActive", "Admin")?id=${slideId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    toastr.success(result.message || 'Slide status updated');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    toastr.error(result.message || 'Failed to update slide status');
                }
            } catch (error) {
                console.error('Error:', error);
                toastr.error('An error occurred while toggling slide status');
            }
        };

        // Toggle category active status
        window.toggleCategoryStatus = async function(categoryId) {
            if (!confirm('Toggle this category\'s active status?')) return;
            
            try {
                const response = await fetch(`@Url.Action("CategoryToggleActive", "Admin")?id=${categoryId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    toastr.success(result.message || 'Category status updated');
                    setTimeout(() => window.location.href = '@Url.Action("Settings", "Admin", new { tab = "categories" })', 1000);
                } else {
                    toastr.error(result.message || 'Failed to update category status');
                }
            } catch (error) {
                console.error('Error:', error);
                toastr.error('An error occurred while toggling category status');
            }
        };

        // Activate the correct tab based on URL parameter or hash
        document.addEventListener('DOMContentLoaded', function() {
            var activeTab = '@(ViewBag.ActiveTab ?? "")';
            
            if (activeTab) {
                const tabButton = document.getElementById(activeTab + '-tab');
                if (tabButton) {
                    const tab = new bootstrap.Tab(tabButton);
                    tab.show();
                }
            } else if (window.location.hash) {
                const hash = window.location.hash.substring(1);
                const tabButton = document.getElementById(hash + '-tab');
                if (tabButton) {
                    const tab = new bootstrap.Tab(tabButton);
                    tab.show();
                }
            }
        });

        // ================================
        // Translation Editor Functions
        // ================================
        let translationFiles = [];
        let currentTranslations = [];
        let currentPage = 1;
        const itemsPerPage = 50;
        let searchDebounceTimer = null;

        // Load translation files list
        async function loadTranslationFiles() {
            try {
                const response = await fetch('@Url.Action("GetAllTranslationFiles", "Admin")');
                const result = await response.json();
                
                if (result.success) {
                    translationFiles = result.data;
                    document.getElementById('totalFilesCount').textContent = translationFiles.length;
                    
                    // Populate file filter dropdown
                    const fileFilterEl = document.getElementById('file-filter');
                    let options = '<option value="">All Files</option>';
                    translationFiles.forEach(file => {
                        options += `<option value="${file.fileName}">${file.displayName} (${file.keyCount} keys)</option>`;
                    });
                    fileFilterEl.innerHTML = options;
                    
                    toastr.success(`Loaded ${translationFiles.length} resource files`);
                } else {
                    toastr.error(result.message || 'Failed to load translation files');
                }
            } catch (error) {
                console.error('Error loading translation files:', error);
                toastr.error('An error occurred while loading translation files');
            }
        }

        // Load translations when file filter changes
        async function handleFileFilterChange() {
            const fileFilterEl = document.getElementById('file-filter');
            const selectedFile = fileFilterEl.value;
            
            if (!selectedFile) {
                // Clear table when "All Files" is selected
                document.getElementById('translations-tbody').innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <i class="bi bi-info-circle fs-1 d-block mb-2"></i>
                            Select a file from the dropdown or use search to view translations
                        </td>
                    </tr>`;
                document.getElementById('translations-results-info').style.display = 'none';
                return;
            }
            
            const loadingEl = document.getElementById('translations-loading');
            const tbodyEl = document.getElementById('translations-tbody');
            const resultsInfoEl = document.getElementById('translations-results-info');
            
            loadingEl.style.display = 'block';
            tbodyEl.innerHTML = '';
            
            try {
                const response = await fetch(`@Url.Action("GetTranslationsByFile", "Admin")?fileName=${encodeURIComponent(selectedFile)}`);
                const result = await response.json();
                
                if (result.success) {
                    currentTranslations = result.data;
                    currentPage = 1;
                    displayTranslations(currentTranslations);
                    resultsInfoEl.style.display = 'block';
                    toastr.success(`Loaded ${currentTranslations.length} translations from ${selectedFile}`);
                } else {
                    toastr.error(result.message || 'Failed to load translations');
                    tbodyEl.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Failed to load translations</td></tr>';
                }
            } catch (error) {
                console.error('Error loading translations:', error);
                toastr.error('An error occurred while loading translations');
                tbodyEl.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading translations</td></tr>';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Restore active tab from localStorage
            const activeTab = localStorage.getItem('admin-settings-active-tab');
            if (activeTab) {
                const tabElement = document.querySelector(`button[data-bs-target="${activeTab}"]`);
                if (tabElement) {
                    const tab = new bootstrap.Tab(tabElement);
                    tab.show();
                }
            }
            
            // Save active tab to localStorage when changed
            document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(button => {
                button.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('data-bs-target');
                    localStorage.setItem('admin-settings-active-tab', target);
                });
            });
            
            // Load translation files when translations tab is shown
            const translationsTab = document.getElementById('translations-tab');
            if (translationsTab) {
                translationsTab.addEventListener('shown.bs.tab', function() {
                    if (translationFiles.length === 0) {
                        loadTranslationFiles();
                    }
                });
            }
        });

        // Display translations in table with pagination
        function displayTranslations(translations) {
            const tbodyEl = document.getElementById('translations-tbody');
            const resultsCountEl = document.getElementById('resultsCount');
            const paginationEl = document.getElementById('translations-pagination');
            
            if (!translations || translations.length === 0) {
                tbodyEl.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-4">No translations found</td></tr>';
                resultsCountEl.textContent = '0';
                paginationEl.style.display = 'none';
                return;
            }
            
            resultsCountEl.textContent = translations.length;
            
            // Calculate pagination
            const totalPages = Math.ceil(translations.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, translations.length);
            const pageTranslations = translations.slice(startIndex, endIndex);
            
            // Build table rows
            let html = '';
            pageTranslations.forEach(trans => {
                const comment = trans.comment || '';
                const commentDisplay = comment ? `<small class="text-muted d-block" style="max-width: 150px; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(comment)}</small>` : '<small class="text-muted fst-italic">No comment</small>';
                
                html += `
                    <tr data-file="${escapeHtml(trans.resourceFile)}" data-key="${escapeHtml(trans.key)}">
                        <td class="d-none d-lg-table-cell">
                            <span class="badge bg-secondary" style="font-size: 0.75rem;">${escapeHtml(trans.resourceFile)}</span>
                        </td>
                        <td>
                            <code style="font-size: 0.85rem; word-break: break-word;">${escapeHtml(trans.key)}</code>
                            <div class="d-lg-none">
                                <small class="badge bg-secondary mt-1" style="font-size: 0.7rem;">${escapeHtml(trans.resourceFile)}</small>
                            </div>
                        </td>
                        <td>
                            <div class="editable-cell" 
                                 contenteditable="true" 
                                 data-culture="en-US" 
                                 data-original="${escapeHtml(trans.englishValue || '')}"
                                 onblur="saveTranslation(this, '${escapeHtml(trans.resourceFile)}', '${escapeHtml(trans.key)}', 'en-US')"
                                 onkeydown="handleCellKeydown(event, this, '${escapeHtml(trans.resourceFile)}', '${escapeHtml(trans.key)}', 'en-US')"
                                 style="min-height: 30px; padding: 0.5rem; border: 1px solid transparent; border-radius: 4px;">${escapeHtml(trans.englishValue || '')}</div>
                        </td>
                        <td>
                            <div class="editable-cell" 
                                 contenteditable="true" 
                                 data-culture="pl-PL" 
                                 data-original="${escapeHtml(trans.polishValue || '')}"
                                 onblur="saveTranslation(this, '${escapeHtml(trans.resourceFile)}', '${escapeHtml(trans.key)}', 'pl-PL')"
                                 onkeydown="handleCellKeydown(event, this, '${escapeHtml(trans.resourceFile)}', '${escapeHtml(trans.key)}', 'pl-PL')"
                                 style="min-height: 30px; padding: 0.5rem; border: 1px solid transparent; border-radius: 4px;">${escapeHtml(trans.polishValue || '')}</div>
                        </td>
                        <td class="d-none d-md-table-cell">
                            <div class="comment-cell-wrapper" style="position: relative;">
                                <div class="editable-cell comment-editable" 
                                     contenteditable="true" 
                                     data-original="${escapeHtml(comment)}"
                                     onblur="saveComment(this, '${escapeHtml(trans.resourceFile)}', '${escapeHtml(trans.key)}')"
                                     onkeydown="handleCommentKeydown(event, this, '${escapeHtml(trans.resourceFile)}', '${escapeHtml(trans.key)}')"
                                     style="min-height: 30px; padding: 0.5rem; border: 1px solid transparent; border-radius: 4px; font-size: 0.85rem;">${escapeHtml(comment)}</div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            tbodyEl.innerHTML = html;
            
            // Show/hide pagination
            if (totalPages > 1) {
                paginationEl.style.display = 'block';
                renderPagination(totalPages);
            } else {
                paginationEl.style.display = 'none';
            }
        }

        // Render pagination controls
        function renderPagination(totalPages) {
            const paginationControls = document.getElementById('pagination-controls');
            let html = '';
            
            // Previous button
            html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">Previous</a>
                     </li>`;
            
            // Page numbers (show max 7 pages)
            const startPage = Math.max(1, currentPage - 3);
            const endPage = Math.min(totalPages, currentPage + 3);
            
            if (startPage > 1) {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(1); return false;">1</a></li>`;
                if (startPage > 2) html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>
                         </li>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                html += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${totalPages}); return false;">${totalPages}</a></li>`;
            }
            
            // Next button
            html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">Next</a>
                     </li>`;
            
            paginationControls.innerHTML = html;
        }

        // Change page
        window.changePage = function(page) {
            currentPage = page;
            const searchTerm = document.getElementById('translation-search-input').value.trim();
            if (searchTerm) {
                performSearch(searchTerm);
            } else {
                displayTranslations(currentTranslations);
            }
        };

        // Search translations with debounce
        document.getElementById('translation-search-input')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.trim();
            
            clearTimeout(searchDebounceTimer);
            
            if (!searchTerm) {
                currentPage = 1;
                const selectedFile = document.getElementById('file-filter').value;
                if (selectedFile) {
                    displayTranslations(currentTranslations);
                } else {
                    document.getElementById('translations-tbody').innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center text-muted py-4">
                                <i class="bi bi-info-circle fs-1 d-block mb-2"></i>
                                Select a file from the dropdown or use search to view translations
                            </td>
                        </tr>`;
                    document.getElementById('translations-results-info').style.display = 'none';
                }
                return;
            }
            
            searchDebounceTimer = setTimeout(() => {
                currentPage = 1;
                performSearch(searchTerm);
            }, 300);
        });

        // Perform search
        async function performSearch(searchTerm) {
            const loadingEl = document.getElementById('translations-loading');
            const tbodyEl = document.getElementById('translations-tbody');
            const resultsInfoEl = document.getElementById('translations-results-info');
            const selectedFile = document.getElementById('file-filter').value;
            
            loadingEl.style.display = 'block';
            
            try {
                const response = await fetch('@Url.Action("SearchTranslations", "Admin")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    },
                    body: JSON.stringify({ 
                        searchTerm: searchTerm,
                        fileName: selectedFile || null
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentTranslations = result.data;
                    displayTranslations(result.data);
                    resultsInfoEl.style.display = 'block';
                    
                    if (result.count === 0) {
                        toastr.info('No translations found matching your search');
                    }
                } else {
                    toastr.error(result.message || 'Search failed');
                    tbodyEl.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Search failed</td></tr>';
                }
            } catch (error) {
                console.error('Error searching translations:', error);
                toastr.error('An error occurred while searching');
                tbodyEl.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error during search</td></tr>';
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        // Clear search
        window.clearSearch = function() {
            document.getElementById('translation-search-input').value = '';
            currentPage = 1;
            const selectedFile = document.getElementById('file-filter').value;
            if (selectedFile) {
                displayTranslations(currentTranslations);
            } else {
                document.getElementById('translations-tbody').innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <i class="bi bi-info-circle fs-1 d-block mb-2"></i>
                            Select a file from the dropdown or use search to view translations
                        </td>
                    </tr>`;
                document.getElementById('translations-results-info').style.display = 'none';
            }
        };

        // Handle keydown in editable cell (save on Enter)
        function handleCellKeydown(event, element, fileName, key, culture) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                element.blur(); // Trigger onblur to save
            } else if (event.key === 'Escape') {
                event.preventDefault();
                // Restore original value
                element.textContent = element.getAttribute('data-original');
                element.blur();
            }
        }

        // Handle keydown in comment cell
        function handleCommentKeydown(event, element, fileName, key) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                element.blur(); // Trigger onblur to save
            } else if (event.key === 'Escape') {
                event.preventDefault();
                element.textContent = element.getAttribute('data-original');
                element.blur();
            }
        }

        // Save comment
        async function saveComment(element, fileName, key) {
            const newValue = element.textContent.trim();
            const originalValue = element.getAttribute('data-original');
            
            // No change, skip save
            if (newValue === originalValue) {
                return;
            }
            
            // Show saving indicator
            element.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span>';
            element.contentEditable = 'false';
            
            try {
                const response = await fetch('@Url.Action("UpdateTranslationComment", "Admin")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    },
                    body: JSON.stringify({
                        fileName: fileName,
                        key: key,
                        comment: newValue
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    element.setAttribute('data-original', newValue);
                    element.innerHTML = escapeHtml(newValue);
                    element.classList.add('save-success');
                    setTimeout(() => element.classList.remove('save-success'), 2000);
                    
                    // Update in-memory data
                    const translation = currentTranslations.find(t => t.resourceFile === fileName && t.key === key);
                    if (translation) {
                        translation.comment = newValue;
                    }
                    
                    toastr.success('Comment updated. Refresh page to see changes throughout the site.');
                } else {
                    element.innerHTML = escapeHtml(originalValue);
                    toastr.error(result.message || 'Failed to save comment');
                }
            } catch (error) {
                console.error('Error saving comment:', error);
                element.innerHTML = escapeHtml(originalValue);
                toastr.error('An error occurred while saving');
            } finally {
                element.contentEditable = 'true';
            }
        }

        // Save translation
        async function saveTranslation(element, fileName, key, culture) {
            const newValue = element.textContent.trim();
            const originalValue = element.getAttribute('data-original');
            
            // No change, skip save
            if (newValue === originalValue) {
                return;
            }
            
            // Show saving indicator
            const originalContent = element.innerHTML;
            element.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Saving...';
            element.contentEditable = 'false';
            
            try {
                const response = await fetch('@Url.Action("UpdateTranslation", "Admin")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    },
                    body: JSON.stringify({
                        fileName: fileName,
                        key: key,
                        cultureCode: culture,
                        value: newValue
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Update original value
                    element.setAttribute('data-original', newValue);
                    element.innerHTML = escapeHtml(newValue);
                    element.classList.add('save-success');
                    setTimeout(() => element.classList.remove('save-success'), 2000);
                    
                    // Update in-memory data
                    const translation = currentTranslations.find(t => t.resourceFile === fileName && t.key === key);
                    if (translation) {
                        if (culture === 'en-US') translation.englishValue = newValue;
                        if (culture === 'pl-PL') translation.polishValue = newValue;
                    }
                    
                    // Show notification with immediate effect
                    toastr.success(`âœ… Translation updated: ${fileName}.${key} (${culture === 'en-US' ? 'ðŸ‡ºðŸ‡¸' : 'ðŸ‡µðŸ‡±'})<br><br>` +
                        `<strong>Changes will appear on next page refresh (F5)</strong>`, 
                        'Saved Successfully', {
                        timeOut: 4000,
                        extendedTimeOut: 2000,
                        closeButton: true,
                        progressBar: true,
                        allowHtml: true,
                        positionClass: 'toast-top-right'
                    });
                } else {
                    // Restore original value on failure
                    element.innerHTML = escapeHtml(originalValue);
                    toastr.error(result.message || 'Failed to save translation');
                }
            } catch (error) {
                console.error('Error saving translation:', error);
                element.innerHTML = escapeHtml(originalValue);
                toastr.error('An error occurred while saving');
            } finally {
                element.contentEditable = 'true';
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Delete Carousel Slide with confirmation
        async function deleteCarouselSlide(evt, slideId, slideTitle) {
            console.log('deleteCarouselSlide called with:', { slideId, slideTitle });
            
            // Show confirmation dialog with SweetAlert2 or native confirm
            const confirmDelete = confirm(`Are you sure you want to delete this carousel slide?\n\n"${slideTitle}"\n\nThis action cannot be undone.`);
            
            if (!confirmDelete) {
                console.log('Delete cancelled by user');
                return;
            }

            try {
                // Show loading state
                const deleteBtn = evt.target.closest('button');
                const originalHtml = deleteBtn.innerHTML;
                deleteBtn.disabled = true;
                deleteBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span>';

                const url = '@Url.Action("CarouselDeleteAjax", "Admin")';
                const requestBody = JSON.stringify({ id: slideId });
                
                console.log('Making DELETE request to:', url);
                console.log('Request body:', requestBody);

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    },
                    body: requestBody
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                const result = await response.json();
                console.log('Response result:', result);

                if (result.success) {
                    // Remove the table row with animation
                    const row = deleteBtn.closest('tr');
                    row.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    row.style.opacity = '0';
                    row.style.transform = 'translateX(-20px)';
                    
                    setTimeout(() => {
                        row.remove();
                        
                        // Check if table is now empty
                        const tbody = document.querySelector('#carouselSlidesTable tbody');
                        if (tbody && tbody.children.length === 0) {
                            location.reload(); // Reload to show empty state
                        }
                    }, 300);

                    // Show success notification
                    toastr.success(result.message || 'Carousel slide deleted successfully', 'Deleted', {
                        timeOut: 3000,
                        closeButton: true,
                        progressBar: true,
                        positionClass: 'toast-top-right'
                    });

                    // Update counters if they exist
                    const totalCounter = document.querySelector('[data-carousel-total]');
                    const activeCounter = document.querySelector('[data-carousel-active]');
                    if (totalCounter) {
                        const currentTotal = parseInt(totalCounter.textContent) || 0;
                        totalCounter.textContent = Math.max(0, currentTotal - 1);
                    }
                } else {
                    // Restore button state on failure
                    deleteBtn.disabled = false;
                    deleteBtn.innerHTML = originalHtml;
                    
                    toastr.error(result.message || 'Failed to delete carousel slide', 'Error', {
                        timeOut: 4000,
                        closeButton: true,
                        positionClass: 'toast-top-right'
                    });
                }
            } catch (error) {
                console.error('Error deleting carousel slide:', error);
                
                // Restore button state
                const deleteBtn = evt.target.closest('button');
                deleteBtn.disabled = false;
                deleteBtn.innerHTML = '<i class="bi bi-trash"></i>';
                
                toastr.error('An error occurred while deleting the slide', 'Error', {
                    timeOut: 4000,
                    closeButton: true,
                    positionClass: 'toast-top-right'
                });
            }
        }
    </script>
}
